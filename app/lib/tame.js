/*
 * TAME [TwinCAT ADS Made Easy] V2.1
 * 
 * Copyright (c) 2009-2012 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * License: MIT - http://www.opensource.org/licenses/mit-license.php
 * 
 */
 var TAME={weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(c){var f=(typeof c.language=="string")?c.language:"ge";this.dateNames={weekdShort:TAME.weekdShortNames[f],weekdLong:TAME.weekdLongNames[f],monthsShort:TAME.monthsShortNames[f],monthsLong:TAME.monthsLongNames[f]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;var I=this,a={M:"16416",MX:"16417",I:"61472",IX:"61473",Q:"61488",QX:"61489"},s={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,DATE:4,DT:4,REAL:4,STRING:80},j=function(){var e={},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var R=0;R<S.length;R++){e[R]=S.charAt(R)}return e}(),m=function(){var e={},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(var R=0;R<S.length;R++){e[S.charAt(R)]=R}return e}(),g=c.dataAlign4,t=[0],d,b,B;if(typeof c.serviceUrl=="string"){d=c.serviceUrl}else{try{console.log("TAME library error: Service URL is not a string!")}catch(P){}return}if(typeof c.amsNetId=="string"){b=c.amsNetId}else{try{console.log("TAME library error: NetId is not a string!")}catch(P){}return}if(c.amsPort===undefined){B="801"}else{if(typeof c.amsPort=="string"&&parseInt(c.amsPort,10)>=801&&parseInt(c.amsPort,10)<=804){B=c.amsPort}else{try{console.log("TAME library error: AMS Port Number ("+parseInt(c.amsPort,10)+") is no string or out of range!")}catch(P){}return}}function x(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function M(U,R){var e=[],T=U.toString(16);while(T.length<R*2){T="0"+T}for(var S=0;S<R;S++){e[(R-1)-S]=((x(T.charCodeAt(S*2))*16)+x(T.charCodeAt((S*2)+1)))}return e}function p(R){var e,U,W,T=0,V,X=0;e=Math.abs(R);if(R!==0){for(var S=128;S>-127;S--){U=e/Math.pow(2,S);if(U>=2){break}W=S;V=U}W+=127;V=V.toString(2);for(S=2;S<25;S++){T<<=1;if(V.charAt(S)=="1"){T+=1}}if(V.charAt(25)=="1"){T+=1}X=W;X<<=23;X+=T;if(R<0){X+=2147483648}}return X}function y(S,R){var e;switch(R){case"#d":case"#dd":e=S*86400000;break;case"#h":case"#hh":e=S*3600000;break;case"#m":case"#mm":e=S*60000;break;case"#s":case"#ss":e=S*1000;break;case"#ms":case"#msmsms":e=S;break;default:e=S;break}return e}function k(W){var V=j,T=0,R="",U,S,e;while(T<W.length){U=W[T++];S=W[T++];e=W[T++];R=R+V[U>>2]+V[((U&3)<<4)|(S>>4)]+(isNaN(S)?"=":V[(((S&15)<<2)|(e>>6))])+((isNaN(S)||isNaN(e))?"=":V[e&63])}return R}function E(R){var e=q(R.charCodeAt(0));return parseInt(e,16)}function N(e){var R=E(e);if(R>127){R=R-256}return R}function C(R){var e=q(R.charCodeAt(1));e+=q(R.charCodeAt(0));return parseInt(e,16)}function A(e){var R=C(e);if(R>32767){R=R-65536}return R}function u(R){var e=q(R.charCodeAt(3));e+=q(R.charCodeAt(2));e+=q(R.charCodeAt(1));e+=q(R.charCodeAt(0));return parseInt(e,16)}function D(e){var R=u(e);if(R>2147483647){R=R-4294967296}return R}function H(e,S){var R=u(e);if(S===undefined){return R}else{return(w(R,S))}}function l(e,S){var R=new Date(u(e));R=new Date(R.getTime()+R.getTimezoneOffset()*60000);if(S===undefined){return R}else{return(Q(R,S))}}function L(R,S){var e=new Date(u(R)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(S===undefined){return e}else{return(Q(e,S))}}function o(S){var e,U,V,W,R=u(S);e=((R>>>31)==1)?"-":"+";R<<=1;V=(R>>>24)-127;W=0.5;U=1;R<<=8;for(var T=1;T<=23;T++){U=U+(R<0?W:0);R<<=1;W/=2}return parseFloat(e+(U*Math.pow(2,V)))}function K(R){var e=R.length;for(var S=0;S<e;S++){if(R.charCodeAt(S)===0){break}}return R.substr(0,S)}function q(R){var e=R.toString(16);if((e.length%2)!==0){e="0"+e}return e}function h(R,e){e=(isNaN(e))?0:e;var S=R.toString(10);while(S.length<e){S="0"+S}return S}function Q(W,V){var e=V.split("#"),U=e.length,R="",T;for(var S=1;S<U;S++){switch(e[S]){case"D":T=W.getDate();break;case"DD":T=W.getDate();T=h(T,2);break;case"WD":T=W.getDay();break;case"WKD":T=I.dateNames.weekdShort[W.getDay()];break;case"WEEKDAY":T=I.dateNames.weekdLong[W.getDay()];break;case"M":T=W.getMonth()+1;break;case"MM":T=W.getMonth()+1;T=h(T,2);break;case"MON":T=I.dateNames.monthsShort[W.getMonth()];break;case"MONTH":T=I.dateNames.monthsLong[W.getMonth()];break;case"YY":T=W.getYear();while(T>100){T-=100}break;case"YYYY":T=W.getFullYear();break;case"h":T=W.getHours();break;case"hh":T=W.getHours();T=h(T,2);break;case"m":T=W.getMinutes();break;case"mm":T=W.getMinutes();T=h(T,2);break;case"s":T=W.getSeconds();break;case"ss":T=W.getSeconds();T=h(T,2);break;case"ms":T=W.getMilliseconds();break;case"msmsms":T=W.getMilliseconds();T=h(T,3);break;default:T=e[S];break}R=R+T}return R}function w(W,V){var e=V.split("#"),U=e.length,R="",T;for(var S=1;S<U;S++){switch(e[S]){case"d":if(U<=2){T=W/86400000}else{T=Math.floor(W/86400000);W=W%86400000}break;case"dd":if(U<=2){T=W/86400000}else{T=Math.floor(W/86400000);W=W%86400000}T=h(T,2);break;case"h":if(U<=2){T=W/3600000}else{T=Math.floor(W/3600000);W=W%3600000}break;case"hh":if(U<=2){T=W/3600000}else{T=Math.floor(W/3600000);W=W%3600000}T=h(T,2);break;case"m":if(U<=2){T=W/60000}else{T=Math.floor(W/60000);W=W%60000}break;case"mm":if(U<=2){T=W/60000}else{T=Math.floor(W/60000);W=W%60000}T=h(T,2);break;case"s":if(U<=2){T=W/1000}else{T=Math.floor(W/1000);W=W%1000}break;case"ss":if(U<=2){T=W/1000}else{T=Math.floor(W/1000);W=W%1000}T=h(T,2);break;case"ms":T=W;break;case"msmsms":T=W;T=h(T,3);break;default:T=e[S];break}R=R+T}return R}function F(T){var U=m,W=0,e="",V,S,R,aa,Z,Y,X;T=T.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aa=U[T.charAt(W++)];Z=U[T.charAt(W++)];Y=U[T.charAt(W++)];X=U[T.charAt(W++)];V=(aa<<2)|(Z>>4);S=((Z&15)<<4)|(Y>>2);R=((Y&3)<<6)|X;e+=String.fromCharCode(V);if(Y!=64){e+=String.fromCharCode(S)}if(X!=64){e+=String.fromCharCode(R)}}while(W<T.length);return e}function r(T,W,Y){var R=[],V=0,S=[],U=0;if(typeof T=="number"){R[0]=T.toString(10)}else{if(typeof T=="string"){R=T.split(".")}else{try{console.log("TAME library error: Can't parse name of object/variable. Name is not a string or number!");console.log(T)}catch(X){}return}}if(Y===undefined){Y=window}V=R.length-1;while(U<V){if(R[U].charAt(R[U].length-1)=="]"){S=R[U].substring(0,R[U].length-1).split("[");Y=Y[S[0]][S[1]]}else{Y=Y[R[U]]}U++}if(R[U].charAt(R[U].length-1)=="]"){S=R[U].substring(0,R[U].length-1).split("[");Y=Y[S[0]];if(W!==undefined){Y[S[1]]=W}return Y[S[1]]}else{if(W!==undefined){Y[R[U]]=W}return Y[R[U]]}}function O(R){if(R===undefined){return false}else{if(!isNaN(R)&&R>0&&R<=I.maxStringLen){return true}else{try{console.log("TAME library error: User defined string length not valid! length: "+R);console.log("Max. string length: "+I.maxStringLen)}catch(S){}return false}}}function n(T){var U="",R=[];if(typeof T.fld!="string"){if(typeof T.addr=="string"&&T.addr.charAt(0)=="%"){if(T.addr.charAt(2)=="X"){T.fld=T.addr.substr(1,2);U=T.addr.substr(3);R=U.split(".");T.addr=R[0]*8+R[1]*1}else{T.fld=T.addr.substr(1,1);T.addr=parseInt(T.addr.substr(3),10)}}else{try{console.log("TAME library error: No field defined (M,MX,I,IX,Q,QX) and address contains no field information (%MB,%MX,%IB,%IX%,%QB,%QX).");console.log("fld:"+T.fld);console.log("addr:"+T.addr)}catch(S){}return}}else{if(T.fld.charAt(0)==="M"||T.fld.charAt(0)==="I"||T.fld.charAt(0)==="Q"){if(typeof T.addr=="string"){T.addr=parseFloat(T.addr)}else{if(typeof T.addr!=="number"){try{console.log("TAME library error: No PLC variable address defined.");console.log("addr:"+T.addr)}catch(S){}return}}if(T.fld.length==2&&T.fld.charAt(1)=="X"){if(T.addr===0){T.addr="0.0"}R=T.addr.toString().split(".");T.addr=R[0]*8+R[1]*1}}else{try{console.log("TAME library error: Field not defined (should be M,MX,I,IX,Q,QX) and address contains no correct field definition.");console.log("fld:"+T.fld);console.log("addr:"+T.addr)}catch(S){}}}if(isNaN(T.addr)){try{console.log("TAME library error: Wrong address definition.");console.log("addr:"+T.addr)}catch(S){}}}function i(e){e.send=function(){var R={};if(typeof e.id=="number"&&t[e.id]>0){try{console.log("TAME library warning: Request dropped (last request with ID "+e.id+" not finished!)")}catch(S){}t[this.id]++;if(t[this.id]<=I.maxDropReq){return}t[this.id]=0}if(XMLHttpRequest!==undefined){this.xmlHttpReq=new XMLHttpRequest()}if(!this.xmlHttpReq){try{this.xmlHttpReq=new ActiveXObject("Msxml2.XMLHTTP")}catch(S){try{this.xmlHttpReq=new ActiveXObject("Microsoft.XMLHTTP")}catch(S){this.xmlHttpReq=null;try{console.log("TAME library error: Failed Creating XMLHttpRequest-Object!")}catch(S){}}}}R="<?xml version='1.0' encoding='utf-8'?><soap:Envelope                         xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'                         xmlns:xsd='http://www.w3.org/2001/XMLSchema'                         xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";R+="<soap:Body><q1:";R+=this.method;R+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";R+=b;R+="</netId><nPort xsi:type='xsd:int'>";R+=B;R+="</nPort><indexGroup xsi:type='xsd:unsignedInt'>";R+=this.indexGroup;R+="</indexGroup><indexOffset xsi:type='xsd:unsignedInt'>";R+=this.indexOffset;R+="</indexOffset>";if(this.cbRdLen>0){R+="<cbRdLen xsi:type='xsd:int'>";R+=this.cbRdLen;R+="</cbRdLen>"}if(this.pData&&this.pData.length>0){R+="<pData>";R+=this.pData;R+="</pData>"}R+="</q1:";R+=this.method;R+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq=="object"){this.xmlHttpReq.open("POST",d,true);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState==4)&&(e.xmlHttpReq.status==200)){I.parseData(e)}};this.xmlHttpReq.send(R);if(typeof this.id=="number"){t[this.id]=1}}};return e}function G(U,T,S,R){var W;if(typeof U.val=="string"){if(T==="REAL"){W=parseFloat(U.val)}else{W=parseInt(U.val,10)}}else{if(typeof U.val=="number"){W=U.val}else{try{console.log("TAME library error: Wrong variable type for a numeric variable in write request!");console.log("TAME library error: Variable type should be number or string, but is "+typeof U.val);console.log(U)}catch(V){}W=0}}if(isNaN(W)){W=0;try{console.log("TAME library error: Value of a numeric variable in write request is not a number.");console.log(U)}catch(V){}}if(I.useCheckBounds===true){if(T==="REAL"){if(W>0){if(W<1.175495e-38){try{console.log("TAME library warning: Lower limit for positive REAL value exceeded!");console.log("limit: 1.175495e-38");console.log("value: "+W);console.log(U)}catch(V){}W=1.175495e-38}else{if(W>3.402823e+38){try{console.log("TAME library warning: Upper limit for positive REAL value exceeded!");console.log("limit: 3.402823e+38");console.log("value: "+W);console.log(U)}catch(V){}W=3.402823e+38}}}else{if(W<0){if(W>-1.175495e-38){try{console.log("TAME library warning: Upper limit for negative REAL value exceeded!");console.log("limit: -1.175495e-38");console.log("value: "+W);console.log(U)}catch(V){}W=-1.175495e-38}else{if(W<-3.402823e+38){try{console.log("TAME library warning: Lower limit for negative REAL value exceeded!");console.log("limit: -3.402823e+38");console.log("value: "+W);console.log(U)}catch(V){}W=-3.402823e+38}}}}}else{if(W<S){try{console.log("TAME library warning: Lower limit for numeric value exceeded!");console.log("type: "+T);console.log("limit: "+S);console.log("value: "+W);console.log(U)}catch(V){}W=S}else{if(W>R){try{console.log("TAME library warning: Upper limit for numeric value exceeded!");console.log("type: "+T);console.log("limit: "+R);console.log("value: "+W);console.log(U)}catch(V){}W=R}}}}return W}function z(U,T,S){var R={},e;e=s[T];switch(T){case"STRING":if(O(S.strlen)){T+="."+S.strlen;e=S.strlen}e++;break;case"TIME":case"TOD":case"DT":case"DATE":if(typeof S.format=="string"){T+="."+S.format}break;case"REAL":if(typeof S.decPlaces=="number"){T+="."+S.decPlaces}else{if(typeof S.dp=="number"){T+="."+S.dp}}break}R={fld:S.fld,addr:S.addr,id:S.id,oc:S.oc,ocd:S.ocd,readLength:e,debug:S.debug,seq:true,items:[{val:S.val,jvar:S.jvar,type:T}]};if(U==="Write"){I.writeReq(R)}else{I.readReq(R)}}function v(T,U,S){var V={},ac={},aa,ae=0,af=0,ad=0,ag,R=[],aj,W,Z=0,ab,X,al,ai,Y,ak;if(T==="Write"&&typeof S.val=="object"){ac=S.val;aa=S.val.length}else{if(typeof S.jvar=="string"){ac=r(S.jvar);aa=r(S.jvar).length}else{try{console.log("TAME library error: No data object for this "+T+"-Request defined!")}catch(ah){}}}if(typeof S.arrlen=="number"){aa=S.arrlen}n(S);if(typeof S.item=="number"&&!isNaN(S.item)&&T==="Write"){ak=true;if(S.item<0||S.item>aa-1){try{console.log('TAME library error: Wrong value for "item"!');console.log("item: "+S.item);console.log("Last array index: "+(aa-1))}catch(ah){}}}if(U==="STRUCT"){if(typeof S.def=="string"){S.def=r(S.def)}else{if(typeof S.def!="object"){try{console.log("TAME library error: No structure definition found!")}catch(ah){}}}if(ak){for(ai in S.def){R=S.def[ai].split(".");if(R[0]=="ARRAY"){aj=parseInt(R[1],10);R.shift();R.shift()}else{aj=1}for(af=0;af<aj;af++){if(R[0]=="STRING"){if(typeof R[1]=="string"){ab=parseInt(R[1],10)}X=(O(ab)?ab:s[R[0]])+1}else{X=s[R[0]]}if(g===true&&X>1&&R[0]!="STRING"&&Z>0){al=Z%X;if(al>0){Z+=X-al}}Z+=X}}S.addr=S.addr+Z*S.item;aa=1}V={fld:S.fld,addr:S.addr,id:S.id,oc:S.oc,ocd:S.ocd,debug:S.debug,seq:true,dataAlign4:g,dataObj:ac,items:[]};for(af=0;af<aa;af++){for(ai in S.def){R=S.def[ai].split(".");if(R[0]=="ARRAY"){aj=parseInt(R[1],10);W=R.length-1;for(ad=0;ad<aj;ad++){if(R[W]=="SP"){V.items[ae]={jvar:af+"."+ai+ad};if(W===4){V.items[ae].type=R[2]+"."+R[3]}else{V.items[ae].type=R[2]}}else{V.items[ae]={jvar:af+"."+ai+"."+ad};if(W===3){V.items[ae].type=R[2]+"."+R[3]}else{V.items[ae].type=R[2]}}if(T==="Write"){if(ak){if(R[W]=="SP"){V.items[ae].val=ac[S.item][ai+ad]}else{V.items[ae].val=ac[S.item][ai][ad]}}else{if(R[W]=="SP"){V.items[ae].val=ac[af][ai+ad]}else{V.items[ae].val=ac[af][ai][ad]}}}ae++}}else{V.items[ae]={jvar:af+"."+ai,type:S.def[ai]};if(T==="Write"){if(ak){V.items[ae].val=ac[S.item][ai]}else{V.items[ae].val=ac[af][ai]}}ae++}}}}else{ag=s[U];switch(U){case"STRING":if(O(S.strlen)){U+="."+S.strlen;ag=S.strlen}ag++;break;case"TIME":case"TOD":case"DT":case"DATE":if(typeof S.format=="string"){U+="."+S.format}break;case"REAL":if(typeof S.decPlaces=="number"){U+="."+S.decPlaces}else{if(typeof S.dp=="number"){U+="."+S.dp}}break}if(ak){S.addr+=S.item*ag;aa=1}V={fld:S.fld,addr:S.addr,id:S.id,oc:S.oc,ocd:S.ocd,readLength:ag*aa,debug:S.debug,seq:true,dataObj:ac,items:[]};for(af=0;af<aa;af++){V.items[af]={jvar:af,type:U};if(T==="Write"){if(ak){V.items[af].val=ac[S.item]}else{V.items[af].val=ac[af]}}}}if(T==="Write"){I.writeReq(V)}else{I.readReq(V)}}function J(R,aa){var W={},S={},ab=[],U=0,Y,T,V,X;if(R==="Write"&&typeof aa.val=="object"){S=aa.val}else{if(typeof aa.jvar=="string"){S=r(aa.jvar)}else{try{console.log("TAME library error: No data object for this "+R+"-Request defined!")}catch(Z){}}}if(typeof aa.def=="string"){aa.def=r(aa.def)}else{if(typeof aa.def!="object"){try{console.log("TAME library error: No structure defininition found!")}catch(Z){}}}W={fld:aa.fld,addr:aa.addr,id:aa.id,oc:aa.oc,ocd:aa.ocd,debug:aa.debug,seq:true,dataAlign4:g,dataObj:S,items:[]};for(V in aa.def){ab=aa.def[V].split(".");if(ab[0]=="ARRAY"){T=parseInt(ab[1],10);Y=ab.length-1;for(X=0;X<T;X++){if(ab[Y]=="SP"){W.items[U]={jvar:V+X};if(Y===4){W.items[U].type=ab[2]+"."+ab[3]}else{W.items[U].type=ab[2]}}else{W.items[U]={jvar:V+"."+X};if(Y===3){W.items[U].type=ab[2]+"."+ab[3]}else{W.items[U].type=ab[2]}}if(R==="Write"){if(ab[Y]=="SP"){W.items[U].val=S[V+X]}else{W.items[U].val=S[V][X]}}U++}}else{W.items[U]={jvar:V,type:aa.def[V]};if(R==="Write"){W.items[U].val=S[V]}U++}}if(R==="Write"){I.writeReq(W)}else{I.readReq(W)}}this.writeReq=function(U){var X=U.items,ad={},R=[],aa=[],ah=[],T,Y,ag,S,ae,ab,af,V,W,ac;n(U);if(U.debug){try{console.log(U)}catch(Z){}}for(ac=0,T=X.length;ac<T;ac++){ah=[0];af=X[ac];if(af.type!==undefined){aa=af.type.split(".")}Y=s[aa[0]];if(U.dataAlign4===true&&Y>1&&aa[0]!="STRING"&&R.length>0){ab=R.length%Y;if(ab>0){ae=Y-ab;for(W=1;W<=ae;W++){R.push(0)}}}if(af.val===undefined){switch(aa[0]){case"STRING":af.val="";break;case"DATE":case"DT":case"TOD":af.val=new Date;break;default:af.val=0;break}try{console.log("TAME library warning: Value of a variable in write request is not defined!");console.log(af)}catch(Z){}}switch(aa[0]){case"BOOL":if(af.val){ah[0]=1}else{ah[0]=0}break;case"BYTE":case"USINT":S=G(af,aa[0],0,255);ah=M(S,Y);break;case"SINT":S=G(af,aa[0],-128,127);if(S<0){S=S+256}ah=M(S,Y);break;case"WORD":case"UINT":S=G(af,aa[0],0,65535);ah=M(S,Y);break;case"INT":S=G(af,aa[0],-32768,32767);if(S<0){S=S+65536}ah=M(S,Y);break;case"INT1DP":af.val=Math.round(af.val*10);S=G(af,aa[0],-32768,32767);if(S<0){S=S+65536}ah=M(S,Y);break;case"DWORD":case"UDINT":S=G(af,aa[0],0,4294967295);ah=M(S,Y);break;case"DINT":S=G(af,aa[0],-2147483648,2147483647);if(S<0){S=S+4294967296}ah=M(S,Y);break;case"REAL":S=G(af,aa[0]);S=p(S);ah=M(S,Y);break;case"DATE":if(typeof af.val=="object"){af.val.setHours(0);af.val.setMinutes(0);af.val.setSeconds(0);S=af.val.getTime()/1000-af.val.getTimezoneOffset()*60}else{try{console.log("TAME library error: Date is not an object!)");console.log(af.val)}catch(Z){}}ah=M(S,Y);break;case"DT":if(typeof af.val=="object"){S=af.val.getTime()/1000-af.val.getTimezoneOffset()*60}else{try{console.log("TAME library error: Date is not an object!)");console.log(af)}catch(Z){}}ah=M(S,Y);break;case"TOD":if(typeof af.val=="object"){af.val.setYear(1970);af.val.setMonth(0);af.val.setDate(1);S=af.val.getTime()-af.val.getTimezoneOffset()*60000}else{try{console.log("TAME library error: Date is not an object!)");console.log(af)}catch(Z){}}ah=M(S,Y);break;case"STRING":ag=(aa[1]===undefined)?s.STRING:parseInt(aa[1],10);if(O(ag)){V=ag<af.val.length?ag:af.val.length;for(W=0;W<V;W++){ah[W]=af.val.charCodeAt(W)}for(W;W<ag;W++){ah[W]=0}ah[W]=0}break;case"TIME":S=af.val*1;S=y(S,aa[1]);if(S<0){S=0;try{console.log("TAME library warning: Lower limit for TIME variable exceeded!)");console.log(af.val+aa[1]);console.log(af)}catch(Z){}}else{if(S>4294967295){S=4294967295;try{console.log("TAME library warning: Upper limit for TIME variable exceeded!)");console.log(af.val+aa[1]);console.log(af)}catch(Z){}}}ah=M(S,Y);break;default:try{console.log("TAME library error: Unknown data type in write request : "+af.type);console.log(af)}catch(Z){}break}R=R.concat(ah)}if(R&&R.length>0){R=k(R)}ad={method:"Write",indexGroup:a[U.fld],indexOffset:U.addr,id:U.id,cbRdLen:0,pData:R,reqDescr:U};i(ad).send()};this.readReq=function(S){var Z={},T=S.items,V=[],R,W,X,aa,Y;n(S);if(S.debug){try{console.log(S)}catch(U){}}if(typeof S.readLength!="number"){S.readLength=0;for(Y=0,R=T.length;Y<R;Y++){V=T[Y].type.split(".");if(V[0]=="STRING"){if(typeof V[1]=="string"){aa=parseInt(V[1],10)}X=(O(aa)?aa:s[V[0]])+1}else{X=s[V[0]]}if(S.seq===true){if(S.dataAlign4===true&&X>1&&V[0]!="STRING"&&S.readLength>0){W=S.readLength%X;if(W>0){S.readLength+=X-W}}S.readLength+=X}else{S.readLength=X+T[Y].addr-S.addr}}}Z={method:"Read",indexGroup:a[S.fld],indexOffset:S.addr,cbRdLen:S.readLength,id:S.id,reqDescr:S};i(Z).send()};this.writeBool=function(e){z("Write","BOOL",e)};this.writeByte=function(e){z("Write","BYTE",e)};this.writeUsint=function(e){z("Write","USINT",e)};this.writeSint=function(e){z("Write","SINT",e)};this.writeWord=function(e){z("Write","WORD",e)};this.writeUint=function(e){z("Write","UINT",e)};this.writeInt=function(e){z("Write","INT",e)};this.writeInt1Dp=function(e){z("Write","INT1DP",e)};this.writeDword=function(e){z("Write","DWORD",e)};this.writeUdint=function(e){z("Write","UDINT",e)};this.writeDint=function(e){z("Write","DINT",e)};this.writeReal=function(e){z("Write","REAL",e)};this.writeString=function(e){z("Write","STRING",e)};this.writeTime=function(e){z("Write","TIME",e)};this.writeTod=function(e){z("Write","TOD",e)};this.writeDate=function(e){z("Write","DATE",e)};this.writeDt=function(e){z("Write","DT",e)};this.readBool=function(e){z("Read","BOOL",e)};this.readByte=function(e){z("Read","BYTE",e)};this.readUsint=function(e){z("Read","USINT",e)};this.readSint=function(e){z("Read","SINT",e)};this.readWord=function(e){z("Read","WORD",e)};this.readUint=function(e){z("Read","UINT",e)};this.readInt=function(e){z("Read","INT",e)};this.readInt1Dp=function(e){z("Read","INT1DP",e)};this.readDword=function(e){z("Read","DWORD",e)};this.readUdint=function(e){z("Read","UDINT",e)};this.readDint=function(e){z("Read","DINT",e)};this.readReal=function(e){z("Read","REAL",e)};this.readString=function(e){z("Read","STRING",e)};this.readTime=function(e){z("Read","TIME",e)};this.readTod=function(e){z("Read","TOD",e)};this.readDate=function(e){z("Read","DATE",e)};this.readDt=function(e){z("Read","DT",e)};this.writeStruct=function(e){J("Write",e)};this.readStruct=function(e){J("Read",e)};this.writeArrayOfBool=function(e){v("Write","BOOL",e)};this.writeArrayOfByte=function(e){v("Write","BYTE",e)};this.writeArrayOfUsint=function(e){v("Write","USINT",e)};this.writeArrayOfSint=function(e){v("Write","SINT",e)};this.writeArrayOfWord=function(e){v("Write","WORD",e)};this.writeArrayOfUint=function(e){v("Write","UINT",e)};this.writeArrayOfInt=function(e){v("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){v("Write","INT1DP",e)};this.writeArrayOfDword=function(e){v("Write","DWORD",e)};this.writeArrayOfUdint=function(e){v("Write","UDINT",e)};this.writeArrayOfDint=function(e){v("Write","DINT",e)};this.writeArrayOfReal=function(e){v("Write","REAL",e)};this.writeArrayOfString=function(e){v("Write","STRING",e)};this.writeArrayOfTime=function(e){v("Write","TIME",e)};this.writeArrayOfTod=function(e){v("Write","TOD",e)};this.writeArrayOfDate=function(e){v("Write","DATE",e)};this.writeArrayOfDt=function(e){v("Write","DT",e)};this.writeArrayOfStruct=function(e){v("Write","STRUCT",e)};this.readArrayOfBool=function(e){v("Read","BOOL",e)};this.readArrayOfByte=function(e){v("Read","BYTE",e)};this.readArrayOfUsint=function(e){v("Read","USINT",e)};this.readArrayOfSint=function(e){v("Read","SINT",e)};this.readArrayOfWord=function(e){v("Read","WORD",e)};this.readArrayOfUint=function(e){v("Read","UINT",e)};this.readArrayOfInt=function(e){v("Read","INT",e)};this.readArrayOfInt1Dp=function(e){v("Read","INT1DP",e)};this.readArrayOfDword=function(e){v("Read","DWORD",e)};this.readArrayOfUdint=function(e){v("Read","UDINT",e)};this.readArrayOfDint=function(e){v("Read","DINT",e)};this.readArrayOfReal=function(e){v("Read","REAL",e)};this.readArrayOfString=function(e){v("Read","STRING",e)};this.readArrayOfTime=function(e){v("Read","TIME",e)};this.readArrayOfTod=function(e){v("Read","TOD",e)};this.readArrayOfDate=function(e){v("Read","DATE",e)};this.readArrayOfDt=function(e){v("Read","DT",e)};this.readArrayOfStruct=function(e){v("Read","STRUCT",e)};this.parseData=function(af){var T=af.xmlHttpReq.responseXML.documentElement,aa=[],S=0,ac,X,U,Z,W,ag,ab,ae,ad,R;if(typeof af.id=="number"){t[af.id]=0}try{X=T.getElementsByTagName("faultstring")[0].firstChild.data;try{ac=T.getElementsByTagName("errorcode")[0].firstChild.data}catch(Y){ac="-"}try{console.log("TAME library error: Message from server:  "+X+" ("+ac+")")}catch(Y){}return}catch(Y){ac=0}if(af.method==="Read"){var V=af.reqDescr.items;try{if(typeof T.normalize=="function"){T.normalize()}U=F(T.getElementsByTagName("ppData")[0].firstChild.data);for(ad=0,R=V.length;ad<R;ad++){aa.length=1;aa=V[ad].type.split(".");if(aa.length>2){ae=aa.slice(1).join(".")}else{ae=aa[1]}W=s[aa[0]];if(!af.reqDescr.seq===true){S=V[ad].addr-af.reqDescr.addr}else{if(af.reqDescr.dataAlign4===true&&W>1&&aa[0]!="STRING"&&S>0){ab=S%W;if(ab>0){S+=W-ab}}}switch(aa[0]){case"BOOL":Z=(U.charCodeAt(S)!="0");break;case"BYTE":case"USINT":Z=E(U.substr(S,W));break;case"SINT":Z=N(U.substr(S,W));break;case"WORD":case"UINT":Z=C(U.substr(S,W));break;case"INT":Z=A(U.substr(S,W));break;case"INT1DP":Z=((A(U.substr(S,W)))/10).toFixed(1);break;case"DWORD":case"UDINT":Z=u(U.substr(S,W));break;case"DINT":Z=D(U.substr(S,W));break;case"REAL":Z=o(U.substr(S,W));if(typeof ae=="string"){Z=Z.toFixed(parseInt(ae,10))}break;case"STRING":if(typeof ae=="string"){ag=parseInt(ae,10)}W=(O(ag)?ag:W)+1;Z=K(U.substr(S,W));break;case"TOD":Z=l(U.substr(S,W),ae);break;case"TIME":Z=H(U.substr(S,W),ae);break;case"DT":case"DATE":Z=L(U.substr(S,W),ae);break;default:try{console.log("TAME library error: Unknown data type at parsing read request: "+V[ad].type)}catch(Y){}break}r(V[ad].jvar,Z,af.reqDescr.dataObj);if(af.reqDescr.seq===true){S+=W}}}catch(Y){try{console.log("TAME library error: Parsing Failed:"+Y);console.log(V[ad])}catch(Y){}return}}if(typeof af.reqDescr.oc=="function"){if(typeof af.reqDescr.ocd=="number"){window.setTimeout(af.reqDescr.oc,af.reqDescr.ocd)}else{af.reqDescr.oc()}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};